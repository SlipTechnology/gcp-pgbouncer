steps:
  - id: 'terraform init'
    name: 'hashicorp/terraform:1.0.0'
    script: terraform init
  - id: 'terraform plan'
    name: 'hashicorp/terraform:1.0.0'
    entrypoint: 'sh'
    args:
      - '-c'
      - |
        export TF_VAR_dbPassword=$(gcloud secrets versions access latest --secret="PGBouncer_dbPassword")
        export TF_VAR_name=pgbouncer
        terraform plan

  - id: 'terraform apply'
    name: 'hashicorp/terraform:1.0.0'
    script: terraform apply --auto-approve

  - id: 'terraform destroy'
    name: 'hashicorp/terraform:1.0.0'
    script: terraform destroy